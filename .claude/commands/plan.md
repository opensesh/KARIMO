# /karimo:plan — PRD Interview Command

Start a structured interview to create a Product Requirements Document (PRD) that can be executed by KARIMO agents.

## Arguments

- `$PRD_NAME` (optional): Name for the PRD. If not provided, will be determined during the interview.

## Behavior

### 1. Load Project Context

Read the following files if they exist:
- `.karimo/config.yaml` — Project rules, boundaries, build commands
- `.karimo/prds/*.md` — Previous PRDs for retrospective context
- `.karimo/templates/PRD_TEMPLATE.md` — Output format
- `.karimo/templates/INTERVIEW_PROTOCOL.md` — Interview flow

If `.karimo/config.yaml` does not exist, note that we will generate it during Round 4.

### 2. Spawn Interviewer Agent

Use the karimo-interviewer agent to conduct the interview:

```
@karimo-interviewer.md
```

Pass the following context to the interviewer:
- Project config (if exists)
- Previous PRD summaries (if any exist)
- The PRD name argument (if provided)

### 3. Interview Flow

The interviewer conducts 5 rounds:

| Round | Name | Duration | Purpose |
|-------|------|----------|---------|
| 1 | Framing | ~5 min | Establish scope, success criteria, risk |
| 2 | Requirements | ~10 min | Break feature into prioritized requirements |
| 3 | Dependencies | ~5 min | Task ordering, file overlaps, external blockers |
| 4 | Agent Context | ~5 min | Patterns, gotchas, design tokens |
| 5 | Retrospective | ~3 min | Learnings from previous PRDs |

### 4. Round Completion Signals

Users signal readiness to proceed with phrases like:
- "Ready to move on"
- "Next"
- "Done with this section"
- "Proceed"
- "That covers it"

### 5. Investigator Agent (Optional)

During Round 3, offer to spawn the investigator agent for codebase scanning:

> "Would you like me to scan the codebase to identify affected files and existing patterns?"

If accepted:
```
@karimo-investigator.md
```

### 6. Config Generation (First Run)

If no `.karimo/config.yaml` exists, generate it from Round 4 answers:

```yaml
project:
  name: "{{project_name}}"
  language: "{{detected_or_stated}}"
  framework: "{{detected_or_stated}}"
  runtime: "{{detected_or_stated}}"

commands:
  build: "{{build_command}}"
  lint: "{{lint_command}}"
  test: "{{test_command_or_null}}"
  typecheck: "{{typecheck_command_or_null}}"

rules:
  - "{{rule_from_interview}}"

boundaries:
  never_touch:
    - "migrations/*.sql"
    - "*.lock"
    - ".env*"
  require_review:
    - "{{sensitive_files_mentioned}}"

iteration_limits:
  base: 3
  per_complexity: 2
  revision_multiplier: 0.5
```

### 7. PRD Generation

After Round 5:
1. Generate the PRD following `.karimo/templates/PRD_TEMPLATE.md`
2. Spawn the reviewer agent:
   ```
   @karimo-reviewer.md
   ```
3. Address any issues flagged by the reviewer
4. Save artifacts to `.karimo/prds/{NNN}_{slug}/`

### 8. PRD Folder Structure

```
.karimo/prds/001_feature-slug/
├── PRD.md              # Narrative document
├── tasks.yaml          # Extracted YAML task block
├── dag.json            # Dependency graph (generated by reviewer)
├── assets/             # Images referenced during interview
└── status.json         # Execution state (empty until /karimo:execute)
```

## Output

On completion, confirm:

> "PRD created at `.karimo/prds/{NNN}_{slug}/PRD.md`
>
> - **Tasks:** {count} tasks defined
> - **Estimated complexity:** {total_complexity} points
> - **Ready tasks:** {ready_count} (no dependencies)
>
> Run `/karimo:execute --prd {slug}` to start execution."
